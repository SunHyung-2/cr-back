<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.amaranth10.cr.cra.cra1000.mapper.CRA1000Mapper">

<!--    CLRS0101 환자현황 ==========================================================================================================================================-->
<!--    환자현황 진료의 목록 조회  -->
    <select id="doctList" resultType="java.util.HashMap">
        SELECT usid as value, user_nm as labelText
          FROM cxusemngmt
         WHERE cxusemngmt.hspt_cd = #{hspt_cd}
           AND cxusemngmt.otpt_mdcr_dr_yn = 'Y'
           AND cxusemngmt.del_yn = 'N'
         ORDER BY user_nm
    </select>
<!--    환자현황 대기 환자수 조회  -->
    <select id="patientCount" resultType="java.util.HashMap">
        SELECT COUNT(CASE WHEN cbotrcinmv.rcpn_stat_cd IN ('R', 'M') THEN 1 END) AS Rcount,
               COUNT(CASE WHEN cbotrcinmv.rcpn_stat_cd = 'W' THEN 1 END) AS Wcount,
               COUNT(CASE WHEN cbotrcinmv.rcpn_stat_cd = 'V' THEN 1 END) AS Vcount,
               COUNT(CASE WHEN cbotrcinmv.rcpn_stat_cd IN ('T', 'D') THEN 1 END) AS Dcount,
               COUNT(CASE WHEN cbotrcinmv.rcpn_stat_cd LIKE '%' THEN 1 END) AS Acount
          FROM cbotrcinmv
         WHERE cbotrcinmv.hspt_cd = #{hspt_cd}
           AND cbotrcinmv.mdcr_date = #{mdcr_date}
           AND cbotrcinmv.mdcr_dr_id like #{mdcr_dr_id}
           AND cbotrcinmv.rcpn_stat_cd != 'C'
    </select>

<!--    환자현황 대기 리스트-->
    <select id="patientList" resultType="com.amaranth10.cr.cra.cra1000.model.Patient">
        SELECT cbotrcinmv.mdcr_date,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4001', cbotrcinmv.rcpn_stat_cd) AS rcpn_stat_cd,
               cbotrcinmv.mdcr_hm,
               cbptbainmt.pt_nm,
               cbptbainmt.pid,
               cbptbainmt.sex_cd As sex,
               CONCAT((TRUNCATE((TO_DAYS(DATE_FORMAT(cbotrcinmv.mdcr_date, '%Y-%m-%d')) - TO_DAYS(DATE_FORMAT(cbptbainmt.dobr, '%Y-%m-%d'))) / 365, 0))) AS age,
               cbotrcinmv.rcpn_stat_cd AS call_patient,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4005', cbotrcinmv.insn_tycd) AS insn_tycd,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4003', cbotrcinmv.fvnr_dvcd) AS fvnr_dvcd,
               fn_get_username(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_dr_id) AS mdcr_dr_id,
               fn_get_deptname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, cbotrcinmv.mddp_cd) AS mddp_cd,
               cbotrcinmv.rcpn_sqno
          FROM cbptbainmt, cbotrcinmv
         WHERE cbotrcinmv.hspt_cd = #{hspt_cd}
           AND cbotrcinmv.hspt_cd = cbptbainmt.hspt_cd
           AND cbotrcinmv.pid = cbptbainmt.pid
           AND cbotrcinmv.mdcr_date = #{mdcr_date}
           AND cbotrcinmv.rcpn_stat_cd IN (
        <foreach collection="rcpn_stat_list" item="item" separator=",">
            #{item}
        </foreach>)
           AND cbotrcinmv.mdcr_dr_id like #{mdcr_dr_id}
           AND cbotrcinmv.rcpn_stat_cd NOT IN ('C')
           AND cbptbainmt.del_yn = 'N'
         ORDER BY cbotrcinmv.mdcr_hm
    </select>
<!--    ==========================================================================================================================================================-->


<!--    CLRS0102 환자정보 ==========================================================================================================================================-->
<!--    환자정보, 접수정보 조회      -->
    <select id="patientDetails" resultType="com.amaranth10.cr.cra.cra1000.model.Patient">
        SELECT cbptbainmt.pid,
               cbptbainmt.pt_nm,
               cbptbainmt.pt_frrn,
               cbptbainmt.pt_srrn,
               cbptbainmt.dobr,
               fn_get_age(cbptbainmt.dobr, '2') As age,
               cbptbainmt.sex_cd As sex,
               cbptbainmt.cntc_tel,
               cbptbainmt.clph_no,
               cbptbainmt.pstl_no,
               cbptbainmt.basc_addr,
               cbptbainmt.detl_addr,
               cbptbainmt.vip_pt_yn,
               cbptbainmt.cncn_pt_yn,
               cbptbainmt.priv_pt_yn,
               cbptbainmt.cmhs_path_dvcd,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4004', cbptbainmt.cmhs_path_dvcd) As cmhs_path_cd_nm,
               cbotrcinmv.rcpn_sqno,
               cbotrcinmv.mdcr_date,
               cbotrcinmv.mdcr_hm,
               cbotrcinmv.mddp_cd,
               cbotrcinmv.mdcr_dr_id,
               cbotrcinmv.fvnr_dvcd,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4003', cbotrcinmv.fvnr_dvcd) As fvnr_dvcd_nm,
               cbotrcinmv.insn_tycd,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4005', cbotrcinmv.insn_tycd) As insn_tycd_nm,
               cbotrcinmv.type_asst_cd,
               fn_get_commname(cbotrcinmv.hspt_cd, cbotrcinmv.mdcr_date, 'CB4010', cbotrcinmv.type_asst_cd) As type_asst_cd_nm,
               cbotrcinmv.rcpn_memo,
               cbotrcinmv.cmhs_prps_cd,
               cbptmeinnt1.memo_dvsn As clr_dvsn,
               cbptmeinnt1.memo_cnts As clr_cnts,
               cbptmeinnt2.memo_dvsn As pat_dvsn,
               cbptmeinnt2.memo_cnts As pat_cnts
        FROM cbptbainmt, cbotrcinmv
        LEFT OUTER JOIN cbptmeinnt As cbptmeinnt1
          ON cbptmeinnt1.hspt_cd = #{hspt_cd}
         AND cbptmeinnt1.pid = #{pid}
         AND cbptmeinnt1.memo_dvsn = 'CLR'
        LEFT OUTER JOIN cbptmeinnt As cbptmeinnt2
          ON cbptmeinnt2.hspt_cd = #{hspt_cd}
         AND cbptmeinnt2.pid = #{pid}
         AND cbptmeinnt2.memo_dvsn = 'PAT'
        WHERE cbotrcinmv.hspt_cd = #{hspt_cd}
          AND cbptbainmt.hspt_cd = cbotrcinmv.hspt_cd
          AND cbotrcinmv.pid = #{pid}
          AND cbptbainmt.pid = cbotrcinmv.pid
          AND cbotrcinmv.rcpn_sqno = #{rcpn_sqno}
<!--        AND cbotrcinmv.hstr_sqno-->
    </select>

<!--    관심환자 여부 수정     -->
    <update id="updatePtCncn">
        UPDATE cbptbainmt
           SET last_updt_usid = #{last_updt_usid},
               last_uddt = #{last_uddt},
               cncn_pt_yn = #{cncn_pt_yn}
        WHERE hspt_cd = #{hspt_cd}
          AND pid = #{pid}
    </update>

<!--    접수메모 저장 및 수정    -->
    <update id="patientRcpnMemo">
        UPDATE cbotrcinnt
           SET last_updt_usid = #{last_updt_usid},
               last_uddt = #{last_uddt},
               rcpn_memo = #{rcpn_memo}
        WHERE hspt_cd = #{hspt_cd}
          AND pid = #{pid}
          AND rcpn_sqno = #{rcpn_sqno}
    </update>

<!--    진료메모 & 환자메모 저장      -->
    <insert id="saveClrPtMemo">
        INSERT INTO cbptmeinnt (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt, pid, memo_dvsn, memo_cnts)
        VALUES (#{hspt_cd}, #{frst_rgst_usid}, #{frst_rgdt}, #{last_updt_usid}, #{last_uddt}, #{pid}, #{memo_dvsn}, #{memo_cnts})
    </insert>

<!--    진료메모 & 환자메모 수정      -->
    <update id="updateClrPtMemo">
        UPDATE cbptmeinnt
        SET last_updt_usid = #{last_updt_usid},
            last_uddt = #{last_uddt},
            memo_cnts = #{memo_cnts}
        WHERE hspt_cd = #{hspt_cd}
          AND pid = #{pid}
          AND memo_dvsn = #{memo_dvsn}
    </update>

<!--    환자정보, 접수정보 수정     -->
    <update id="updatePtRcpn">
        UPDATE cbptbainmt As cbptbainmt
        JOIN cbotrcinnt As cbotrcinnt
          ON cbotrcinnt.hspt_cd = cbptbainmt.hspt_cd
         AND cbotrcinnt.pid = cbptbainmt.pid
         AND cbotrcinnt.rcpn_sqno = #{rcpn_sqno}
        SET cbptbainmt.last_uddt = #{last_uddt},
            cbptbainmt.last_updt_usid = #{last_updt_usid},
            cbptbainmt.cntc_tel = #{patient.cntc_tel},
            cbptbainmt.clph_no = #{patient.clph_no},
            cbptbainmt.pstl_no = #{patient.pstl_no},
            cbptbainmt.basc_addr = #{patient.basc_addr},
            cbptbainmt.detl_addr = #{patient.detl_addr},
            cbptbainmt.vip_pt_yn = #{patient.vip_pt_yn},
            cbptbainmt.priv_pt_yn = #{patient.priv_pt_yn},
            cbptbainmt.cmhs_path_dvcd = #{patient.cmhs_path_dvcd},
            cbotrcinnt.last_uddt = #{last_uddt},
            cbotrcinnt.last_updt_usid = #{last_updt_usid},
            cbotrcinnt.mdcr_date = #{patient.cr_date},
            cbotrcinnt.mdcr_hm = #{patient.mdcr_hm},
            cbotrcinnt.mddp_cd = #{patient.mddp_cd},
            cbotrcinnt.mdcr_dr_id = #{patient.mdcr_dr_id},
            cbotrcinnt.fvnr_dvcd = #{patient.fvnr_dvcd},
            cbotrcinnt.insn_tycd = #{patient.insn_tycd},
            cbotrcinnt.cmhs_prps_cd = #{patient.cmhs_prps_cd}
        WHERE cbptbainmt.hspt_cd = #{hspt_cd}
          AND cbptbainmt.pid = #{pid}
    </update>

<!--    보험 구분 목록   -->
    <select id="insnList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_expl As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB4005'
        ORDER BY cmcd_sort_seq
    </select>

<!--    초재진 구분 목록   -->
    <select id="fvnrList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_expl As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB4003'
        ORDER BY cmcd_sort_seq
    </select>

<!--    부서 목록    -->
    <select id="depList" resultType="java.util.HashMap">
        SELECT dept_cd As value,
               dept_hnm As text
        FROM cxdepinfmt
        WHERE hspt_cd = #{hspt_cd}
        ORDER BY dept_hnm
    </select>

    <!--    내원경로 목록     -->
    <select id="pathList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB4004'
        ORDER BY cmcd_cd
    </select>

<!--    내원목적 목록     -->
    <select id="prpsList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB4009'
        ORDER BY cmcd_cd
    </select>

<!--    ==========================================================================================================================================================-->

<!--    CRA1030 신체사정정보 / 검사결과 ================================================================================================================================-->
<!--    신체사정정보 조회-->
    <select id="vitalData" resultType="com.amaranth10.cr.cra.cra1000.model.Vital">
        SELECT DATE_FORMAT(inpt_dt, '%Y-%m-%d %H:%i') AS inpt_dt,
               sbp,
               dbp,
               bt,
               fbs,
               rr,
               pr,
               hght,
               wght,
               ROUND(wght / (POWER(hght / 100, 2)), 2) AS bmi,
               sqno
          FROM crvitlsgnt
         WHERE crvitlsgnt.hspt_cd = #{hspt_cd}
           AND crvitlsgnt.pid = #{pid}
           AND crvitlsgnt.del_yn = 'N'
         ORDER BY inpt_dt DESC
    </select>

<!--    신체사정그래프 데이터 조회-->
    <select id="vitalGraphData" resultType="com.amaranth10.cr.cra.cra1000.model.Vital">
        SELECT DATE_FORMAT(crvitlsgnt.inpt_dt, '%Y-%m-%d') AS inpt_dt,
               sbp,
               dbp,
               pr,
               rr,
               bt,
               fbs
          FROM crvitlsgnt
         WHERE crvitlsgnt.hspt_cd = #{hspt_cd}
           AND crvitlsgnt.pid = #{pid}
           AND DATE_FORMAT(crvitlsgnt.inpt_dt, '%Y%m%d') BETWEEN #{from} AND #{to}
           AND crvitlsgnt.del_yn = 'N'
         ORDER BY inpt_dt DESC
    </select>

<!--    검사결과 조회-->
    <select id="examResult" resultType="com.amaranth10.cr.cra.cra1000.model.Exam">
        SELECT DATE_FORMAT(csexmrelnt.exmn_date, '%Y-%m-%d') AS exmn_date,
               csexmrelnt.prsc_prgr_stat_cd,
               csexmrelnt.exmn_cd,
               crprsccdmt.prsc_nm,
               csexmrelnt.exmn_rslt1,
               csexmrelnt.nots_low,
               csexmrelnt.nots_high,
               csexmrelnt.prsc_sqno
          FROM csexmrelnt, crprsccdmt
         WHERE csexmrelnt.hspt_cd = #{hspt_cd}
           AND csexmrelnt.pid = #{pid}
           AND csexmrelnt.hspt_cd = crprsccdmt.hspt_cd
           AND csexmrelnt.exmn_cd = crprsccdmt.prsc_cd
         ORDER BY csexmrelnt.exmn_date DESC, csexmrelnt.prsc_sqno DESC
    </select>
<!--    ==========================================================================================================================================================-->


<!--    CRA1040 경과기록 ===========================================================================================================================================-->
<!--    경과기록 리스트 조회-->
    <select id="progressList" resultType="java.util.HashMap">
        SELECT fn_get_commname(crprogrsnt.hspt_cd, cbotrcinmv.mdcr_date, 'CB4003', cbotrcinmv.fvnr_dvcd) as fvnr_dvnm,
               cbotrcinmv.fvnr_dvcd,
               DATE_FORMAT(crprogrsnt.inpt_dt,'%Y-%m-%d') AS inpt_dt,
               crprogrsnt.rcpn_sqno,
               crprogrsnt.prgr_sqno
          FROM crprogrsnt, cbotrcinmv
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.del_yn = 'N'
           AND crprogrsnt.hspt_cd = cbotrcinmv.hspt_cd
           AND crprogrsnt.pid = cbotrcinmv.pid
           AND crprogrsnt.rcpn_sqno = cbotrcinmv.rcpn_sqno
         ORDER BY cbotrcinmv.mdcr_date DESC, crprogrsnt.prgr_sqno desc
    </select>

<!--    경과기록 기본형 데이터 조회-->
    <select id="progressData" resultType="java.lang.String">
        SELECT IFNULL(prgr_rcrd, '')
          FROM crprogrsnt
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.rcpn_sqno = #{rcpn_sqno}
           AND crprogrsnt.prgr_sqno = #{prgr_sqno}
           AND crprogrsnt.del_yn = 'N'
    </select>

<!--    경과기록 SOAP 데이터 조회-->
    <select id="progressSOAPData" resultType="java.util.HashMap">
        SELECT sbjt_cnts, objt_cnts, asss_cnts, plan
          FROM crprogrsnt
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.rcpn_sqno = #{rcpn_sqno}
           AND crprogrsnt.prgr_sqno = #{prgr_sqno}
           AND crprogrsnt.del_yn = 'N'
    </select>

<!--    경과기록 일련번호 체크-->
    <select id="prgrSqnoCheck" resultType="java.lang.Integer">
        SELECT IFNULL(MAX(prgr_sqno) + 1, 1)
          FROM crprogrsnt
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.rcpn_sqno = #{rcpn_sqno}
    </select>

<!--    경과기록 추가-->
    <insert id="progressInsert">
        INSERT INTO crprogrsnt (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt, pid, inpt_dt, rcpn_sqno, prgr_sqno, del_yn)
        VALUES (#{hspt_cd}, #{frst_rgst_usid}, #{frst_rgdt}, #{last_updt_usid}, #{last_uddt}, #{pid}, #{inpt_dt}, #{rcpn_sqno}, #{prgr_sqno}, 'N')
    </insert>

<!--    경과기록 수정-->
    <update id="progressUpdate">
        UPDATE crprogrsnt
           SET last_updt_usid = #{last_updt_usid}, last_uddt = #{last_uddt}, prgr_rcrd = #{prgr_rcrd},
               sbjt_cnts = #{sbjt_cnts}, objt_cnts = #{objt_cnts}, asss_cnts = #{asss_cnts}, plan = #{plan}
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.rcpn_sqno = #{rcpn_sqno}
           AND crprogrsnt.prgr_sqno = #{prgr_sqno}
    </update>

<!--    경과기록 삭제-->
    <update id="progressDelete">
        UPDATE crprogrsnt
           SET crprogrsnt.last_updt_usid = #{last_updt_usid}, crprogrsnt.last_uddt = #{last_uddt}, crprogrsnt.del_yn = 'Y'
         WHERE crprogrsnt.hspt_cd = #{hspt_cd}
           AND crprogrsnt.pid = #{pid}
           AND crprogrsnt.rcpn_sqno = #{rcpn_sqno}
           AND crprogrsnt.prgr_sqno = #{prgr_sqno}
    </update>
<!--    ==========================================================================================================================================================-->


<!--    CLRS0106 처방조회 ==========================================================================================================================================-->
<!--    과거기록 조회     -->
    <select id="pastList" resultType="com.amaranth10.cr.cra.cra1000.model.Reception">
        SELECT rcpn_sqno,
               DATE_FORMAT(mdcr_date, '%Y-%m-%d') AS mdcr_date,
               fn_get_username(hspt_cd, mdcr_dr_id) As mdcr_dr_id,
               fn_get_deptname(hspt_cd, mdcr_date, mddp_cd) As mddp_cd,
               fn_get_commname(hspt_cd, mdcr_date, 'CB4003', fvnr_dvcd) As fvnr_dvcd,
               fn_get_commname(hspt_cd, mdcr_date, 'CB4005', insn_tycd) As insn_tycd
        FROM cbotrcinmv
        WHERE hspt_cd = #{hspt_cd}
          AND pid = #{pid}
        <![CDATA[AND mdcr_date <= #{date}]]>
        ORDER BY mdcr_date DESC
    </select>

<!--    경과기록 조회     -->
    <select id="prgrList" resultType="com.amaranth10.cr.cra.cra1000.model.Progress">
        SELECT prgr_rcrd,
               sbjt_cnts,
               objt_cnts,
               asss_cnts,
               plan,
               rcpn_sqno,
               prgr_sqno
        FROM crprogrsnt
        WHERE hspt_cd = #{hspt_cd}
          AND del_yn = 'N'
          AND pid = #{pid}
          AND rcpn_sqno = #{rcpn_sqno}
    </select>

<!--    SLIP 목록     -->
    <select id="slipList" resultType="com.amaranth10.cr.cra.cra1000.model.Slip">
        SELECT slip_cd,
               slip_nm,
               clsf_dvcd
        FROM crslipclmt
        WHERE hspt_cd = #{hspt_cd}
        ORDER BY slip_cd
    </select>

<!--    SLIP 수가 항목      -->
    <select id="slipPrscList" resultType="com.amaranth10.cr.cra.cra1000.model.Prescription">
        SELECT prsc_cd,
               prsc_nm
        FROM crprsccdmt
        WHERE hspt_cd = #{hspt_cd}
          AND prsc_psbl_yn = "Y"
          AND slip_cd = #{slip_cd}
        ORDER BY prsc_nm
    </select>
<!--    ==========================================================================================================================================================-->


<!--    CLRS0107 진단 ==========================================================================================================================================-->
<!--    진단 검색       -->
    <select id="dgnsMList" resultType="com.amaranth10.cr.cra.cra1000.model.Diagnosis">
        SELECT dgns_cd,
               dgns_hnm As dgns_nm,
               dgns_enm,
               spcf_rgno,
               main_ilns_use_yn,
               sex_cd,
               uplm_age,
               lwlm_age
        FROM crkcddgcmt
        WHERE hspt_cd = #{hspt_cd}
          AND (dgns_cd LIKE CONCAT("%", #{keyword}, "%")
            OR dgns_enm LIKE CONCAT("%", #{keyword}, "%")
            OR dgns_hnm LIKE CONCAT("%", #{keyword}, "%"))
    </select>

<!--    진단 내역       -->
    <select id="dgnsList" resultType="com.amaranth10.cr.cra.cra1000.model.Diagnosis">
        SELECT dgns_sqno,
               dgns_cd,
               dgns_nm,
               dvsn,
               IF(ro_yn = "Y", "True", "False") As ro_yn,
               site_dvcd,
               spcf_rgno,
               hspt_cd,
               rcpn_sqno
        FROM crptdgnsnt
        WHERE hspt_cd = #{hspt_cd}
          AND del_yn = "N"
          AND rcpn_sqno = #{rcpn_sqno}
          AND pid = #{pid}
        ORDER BY sort_sqno
    </select>

<!--    진단 저장       -->
    <insert id="savePtDgns" parameterType="java.util.Objects">
        <if test='dgnsList != null and dgnsList.size != 0'>
            <foreach item="item" collection="dgnsList" separator=";">
                INSERT INTO crptdgnsnt
                SELECT
                    #{hspt_cd},
                    #{frst_rgst_usid},
                    #{frst_rgdt},
                    #{last_updt_usid},
                    #{last_uddt},
                    #{pid},
                    #{rcpn_sqno},
                    IFNULL(MAX(crptdgnsnt.dgns_sqno) + 1, 1),
                    #{date},
                    #{mddp_cd},
                    #{usid},
                    #{item.dgns_cd},
                    #{item.dgns_nm},
                    #{item.dvsn},
                    <choose>
                        <when test='item.ro_yn == "True"'>'Y',</when>
                        <otherwise>'N',</otherwise>
                    </choose>
                    #{item.site_dvcd},
                    #{item.spcf_rgno},
                    'N',
                    #{item.row}
                FROM crptdgnsnt
                WHERE hspt_cd = #{hspt_cd}
                  AND rcpn_sqno = #{rcpn_sqno}
                  AND pid = #{pid}
            </foreach>
        </if>
    </insert>

<!--    진단 수정       -->
    <update id="updatePtDgns" parameterType="java.util.Objects">
        <if test="updateList != null and updateList.size != 0">
            <foreach collection="updateList" item="item" index="index" separator=";">
                <if test='item.dgns_sqno != null and !item.dgns_sqno.equals("")'>
                    UPDATE crptdgnsnt
                    SET last_updt_usid = #{last_updt_usid},
                        last_uddt = #{last_uddt},
                        dvsn = #{item.dvsn},
                        ro_yn =
                            <choose>
                                <when test='item.ro_yn == "True"'>'Y',</when>
                                <otherwise>'N',</otherwise>
                            </choose>
                        dgns_nm = #{item.dgns_nm},
                        site_dvcd = #{item.site_dvcd},
                        spcf_rgno = #{item.spcf_rgno},
                        sort_sqno = #{item.row}
                    WHERE hspt_cd = #{hspt_cd}
                      AND rcpn_sqno = #{rcpn_sqno}
                      AND dgns_sqno = #{item.dgns_sqno}
                </if>
            </foreach>;
        </if>
        <if test="delList != null and delList.size != 0">
            <foreach collection="delList" item="item">
                UPDATE crptdgnsnt
                   SET del_yn = 'Y'
                WHERE hspt_cd = #{hspt_cd}
                  AND rcpn_sqno = #{rcpn_sqno}
                  AND dgns_sqno = #{item.dgns_sqno}
            </foreach>;
        </if>
    </update>

<!--    진단 형태 목록        -->
    <select id="dvsnList" resultType="java.util.HashMap">
        SELECT cmcd_cd As code,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CR2001'
        ORDER BY cmcd_cd
    </select>

<!--    진단 부위 목록        -->
    <select id="siteList" resultType="java.util.HashMap">
        SELECT cmcd_cd As code,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CR2003'
        ORDER BY cmcd_cd
    </select>
<!--    ==========================================================================================================================================================-->


<!--    CLRS0108 처방 ==========================================================================================================================================-->
<!--    처방 검색       -->
    <select id="prscMList" resultType="com.amaranth10.cr.cra.cra1000.model.Prescription">
        SELECT prsc_cd,
               prsc_nm,
               prsc_clsf_cd,
               slip_cd,
               drug_injc_dvsn,
               iotm_cd,
               inpy_dvcd,
               basc_dosg As dosg_1,
               basc_notm As notm,
<!--        crprsccdmt.prsc_psbl_yn,-->
               basc_aomd_uncd,
               spcm_cd_1,
               exrm_cd,
               hsot_prsc_yn As hsin_hsot_dvcd,
               spfm_excp_cd As hsin_prsc_resn_cd,
               ctnt_uncd As uncd,
               exmn_rslt_uncd
        FROM crprsccdmt
        WHERE hspt_cd = #{hspt_cd}
          AND prsc_psbl_yn = "Y"
          AND (prsc_cd LIKE CONCAT("%", #{keyword}, "%")
            OR prsc_nm LIKE CONCAT("%", #{keyword}, "%"))
    </select>

<!--    처방 내역       -->
    <select id="prscList" resultType="com.amaranth10.cr.cra.cra1000.model.Prescription">
        SELECT prsc_sqno,
                prsc_cd,
                prsc_nm,
                prsc_clsf_cd,
                dosg_1,
                notm,
                nody,
                drug_injc_dvsn,
                iotm_cd,
                pwdr_yn,
                mix_yn,
                mix_no,
        spcm_cd_1,
                prsc_pay_dvcd,
                fn_get_commname(hspt_cd, mdcr_date, 'CB3001', prsc_pay_dvcd) As prsc_pay_dvcd_nm,
                hsin_hsot_dvcd,
                hsin_prsc_resn_cd,
                cmpt_yn,
                prsc_memo,
                jx999,
                dc_yn,
                dc_resn_cd,
                dc_resn
        FROM crprescpmv
        WHERE hspt_cd = #{hspt_cd}
          AND rcpn_sqno = #{rcpn_sqno}
          AND pid = #{pid}
        ORDER BY sort_sqno
    </select>

<!--    처방 저장       -->
    <insert id="savePtPrsc" parameterType="java.util.Objects">
        <if test='prscList != null and prscList.size != 0'>
            <foreach collection="prscList" item="item" separator=";" index="index">
                <!-- 기본 처방 -->
                <if test='item.prsc_clsf_cd == "A1" or item.prsc_clsf_cd == "A2" or item.prsc_clsf_cd == "A3"'>
                    INSERT INTO crbasprsnt
                        (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                        pid, prsc_date, prsc_sqno, prsc_cd, prsc_nm, rcpn_sqno, prsc_clsf_cd, slip_cd,
                        mdcr_date, mdcr_hm, mddp_cd, mdcr_dr_id, prsc_dr_id, prsc_inpt_dt, prsc_pay_dvcd,
                        insn_tycd, type_asst_cd, sort_sqno, cmpt_yn, prsc_memo, jx999, dc_yn,
                        prsc_prgr_stat_cd, rcpt_stat_cd)
                    SELECT
                        #{hspt_cd},
                        #{frst_rgst_usid},
                        #{frst_rgdt},
                        #{last_updt_usid},
                        #{last_uddt},
                        #{pid},
                        #{date},
                        IFNULL(MAX(crbasprsnt.prsc_sqno) + 1, 1),
                        #{item.prsc_cd},
                        #{item.prsc_nm},
                        #{rcpn_sqno},
                        #{item.prsc_clsf_cd},
                        #{item.slip_cd},
                        cbotrcinmv.mdcr_date,
                        cbotrcinmv.mdcr_hm,
                        #{mddp_cd},
                        #{usid},
                        #{usid},
                        #{dateTime},
                        #{item.prsc_pay_dvcd},

                        cbotrcinmv.insn_tycd,
                        cbotrcinmv.type_asst_cd,

                        #{item.row},
                        #{item.cmpt_yn},
                        #{item.prsc_memo},
                        #{item.jx999},
                        'N',
                    '',
                    'N'
                    FROM crbasprsnt, cbotrcinmv
                    WHERE crbasprsnt.hspt_cd = #{hspt_cd}
                      AND crbasprsnt.rcpn_sqno = #{rcpn_sqno}
                      AND crbasprsnt.pid = #{pid}
                      AND cbotrcinmv.hspt_cd = #{hspt_cd}
                      AND cbotrcinmv.rcpn_sqno = #{rcpn_sqno}
                      AND cbotrcinmv.pid = #{pid}
                </if>
                <!-- 약주사 처방 -->
                <if test='item.prsc_clsf_cd == "B1" or item.prsc_clsf_cd == "B2" or item.prsc_clsf_cd == "B3" or item.prsc_clsf_cd == "B4"'>
                    INSERT INTO crdrinprnt
                        (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                        pid, prsc_date, prsc_sqno, prsc_cd, prsc_nm, rcpn_sqno, prsc_clsf_cd, slip_cd,
                        mdcr_date, mdcr_hm, mddp_cd, mdcr_dr_id, prsc_dr_id, prsc_inpt_dt, insn_tycd, type_asst_cd,
                        sort_sqno, cmpt_yn, prsc_memo, jx999, dc_yn,
                        dosg_1, uncd, totl_vol, notm, nody, drug_injc_dvsn,
                        iotm_cd, prsc_pay_dvcd, pwdr_yn, mix_yn, mix_no,
                        hsin_hsot_dvcd, hsin_prsc_resn_cd, prsc_prgr_stat_cd, rcpt_stat_cd)
                    SELECT
                        #{hspt_cd},
                        #{frst_rgst_usid},
                        #{frst_rgdt},
                        #{last_updt_usid},
                        #{last_uddt},
                        #{pid},
                        #{date},
                        IFNULL(MAX(crdrinprnt.prsc_sqno) + 1, 1),
                        #{item.prsc_cd},
                        #{item.prsc_nm},
                        #{rcpn_sqno},
                        #{item.prsc_clsf_cd},
                        #{item.slip_cd},
                        cbotrcinmv.mdcr_date,
                        cbotrcinmv.mdcr_hm,
                        #{mddp_cd},
                        #{usid},
                        #{usid},
                        #{dateTime},
                        cbotrcinmv.insn_tycd,
                    cbotrcinmv.type_asst_cd,
                        #{item.row},
                        #{item.cmpt_yn},
                        #{item.prsc_memo},
                        #{item.jx999},
                        'N',
                        #{item.dosg_1},
                        #{item.uncd},
                        #{item.totl_vol},
                        #{item.notm},
                        #{item.nody},
                        #{item.drug_injc_dvsn},
                        #{item.iotm_cd},
                        #{item.prsc_pay_dvcd},
                        #{item.pwdr_yn},
                        #{item.mix_yn},
                        #{item.mix_no},
                        #{item.hsin_hsot_dvcd},
                        #{item.hsin_prsc_resn_cd},
                    '',
                    'N'
                    FROM crdrinprnt, cbotrcinmv
                    WHERE crdrinprnt.hspt_cd = #{hspt_cd}
                      AND crdrinprnt.rcpn_sqno = #{rcpn_sqno}
                      AND crdrinprnt.pid = #{pid}
                      AND cbotrcinmv.hspt_cd = #{hspt_cd}
                      AND cbotrcinmv.rcpn_sqno = #{rcpn_sqno}
                      AND cbotrcinmv.pid = #{pid}
                </if>
                <!-- 검사 처방 -->
                <if test='item.prsc_clsf_cd == "C1" or item.prsc_clsf_cd == "C2" or item.prsc_clsf_cd == "C3"'>
                    INSERT INTO crexmprsnt
                        (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                        pid, prsc_date, prsc_sqno, prsc_cd, prsc_nm, rcpn_sqno, prsc_clsf_cd, slip_cd,
                        mdcr_date, mdcr_hm, mddp_cd, mdcr_dr_id, prsc_dr_id, prsc_inpt_dt, prsc_pay_dvcd,
                        insn_tycd, type_asst_cd, sort_sqno, cmpt_yn, prsc_memo, jx999, dc_yn,
                        spcm_cd_1, hope_exrm_cd, prsc_prgr_stat_cd, rcpt_stat_cd )
                    SELECT
                        #{hspt_cd},
                        #{frst_rgst_usid},
                        #{frst_rgdt},
                        #{last_updt_usid},
                        #{last_uddt},
                        #{pid},
                        #{date},
                        IFNULL(MAX(crexmprsnt.prsc_sqno) + 1, 1),
                        #{item.prsc_cd},
                        #{item.prsc_nm},
                        #{rcpn_sqno},
                        #{item.prsc_clsf_cd},
                        #{item.slip_cd},
                        cbotrcinmv.mdcr_date,
                        cbotrcinmv.mdcr_hm,
                        #{mddp_cd},
                        #{usid},
                        #{usid},
                        #{dateTime},
                        #{item.prsc_pay_dvcd},
                        cbotrcinmv.insn_tycd,
                        cbotrcinmv.type_asst_cd,
                        #{item.row},
                        #{item.cmpt_yn},
                        #{item.prsc_memo},
                        #{item.jx999},
                        'N',
                        #{item.spcm_cd_1},
                        #{item.exrm_cd},
                    '',
                    'N'
                    FROM crexmprsnt, cbotrcinmv
                    WHERE crexmprsnt.hspt_cd = #{hspt_cd}
                      AND crexmprsnt.rcpn_sqno = #{rcpn_sqno}
                      AND crexmprsnt.pid = #{pid}
                      AND cbotrcinmv.hspt_cd = #{hspt_cd}
                      AND cbotrcinmv.rcpn_sqno = #{rcpn_sqno}
                      AND cbotrcinmv.pid = #{pid}
                </if>
                <!-- 처치 처방 -->
                <if test='item.prsc_clsf_cd == "D" or item.prsc_clsf_cd == "D1" or item.prsc_clsf_cd == "D2" or item.prsc_clsf_cd == "D3" or item.prsc_clsf_cd == "D4" or item.prsc_clsf_cd == "D5"'>
                    INSERT INTO crtrtprsnt
                        (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                        pid, prsc_date, prsc_sqno, prsc_cd, prsc_nm, rcpn_sqno, prsc_clsf_cd, slip_cd,
                        mdcr_date, mdcr_hm, mddp_cd, mdcr_dr_id, prsc_dr_id, prsc_inpt_dt, prsc_pay_dvcd,
                        insn_tycd, type_asst_cd, sort_sqno, cmpt_yn, prsc_memo, jx999, dc_yn,
                        qty, notm, uncd, prsc_prgr_stat_cd, rcpt_stat_cd)
                    SELECT
                        #{hspt_cd},
                        #{frst_rgst_usid},
                        #{frst_rgdt},
                        #{last_updt_usid},
                        #{last_uddt},
                        #{pid},
                        #{date},
                        IFNULL(MAX(crtrtprsnt.prsc_sqno) + 1, 1),
                        #{item.prsc_cd},
                        #{item.prsc_nm},
                        #{rcpn_sqno},
                        #{item.prsc_clsf_cd},
                        #{item.slip_cd},
                        cbotrcinmv.mdcr_date,
                        cbotrcinmv.mdcr_hm,
                        #{mddp_cd},
                        #{usid},
                        #{usid},
                        #{dateTime},
                        #{item.prsc_pay_dvcd},
                        cbotrcinmv.insn_tycd,
                        cbotrcinmv.type_asst_cd,
                        #{item.row},
                        #{item.cmpt_yn},
                        #{item.prsc_memo},
                        #{item.jx999},
                        'N',
                        #{item.dosg_1},
                        #{item.notm},
                        #{item.uncd},
                    '',
                    'N'
                    FROM crtrtprsnt, cbotrcinmv
                    WHERE crtrtprsnt.hspt_cd = #{hspt_cd}
                      AND crtrtprsnt.rcpn_sqno = #{rcpn_sqno}
                      AND crtrtprsnt.pid = #{pid}
                      AND cbotrcinmv.hspt_cd = #{hspt_cd}
                      AND cbotrcinmv.rcpn_sqno = #{rcpn_sqno}
                      AND cbotrcinmv.pid = #{pid}
                </if>
            </foreach>
        </if>
    </insert>

<!--    처방 수정       -->
    <update id="updatePtPrsc" parameterType="java.util.Objects">
        <if test='updateList != null and updateList.size != 0'>
            <foreach collection="updateList" item="item" separator=";">
                <!-- 기본 처방 -->
                <if test='item.prsc_clsf_cd == "A1" or item.prsc_clsf_cd == "A2" or item.prsc_clsf_cd == "A3"'>
                    UPDATE crbasprsnt
                    SET last_updt_usid= #{last_updt_usid},
                        last_uddt= #{last_uddt},
                        prsc_nm = #{item.prsc_nm},
                        sort_sqno = #{item.row},
                        cmpt_yn = #{item.cmpt_yn},
                        prsc_memo = #{item.prsc_memo},
                        jx999 = #{item.jx999},
                    prsc_pay_dvcd = #{item.prsc_pay_dvcd},
                        dc_yn = #{item.dc_yn}
                    <if test='item.dc_yn == "Y"'>
                        , dc_drcn_dr_id = #{usid},
                        dc_drcn_dt = #{dateTime},
                        dc_resn = #{item.dc_resn},
                        dc_resn_cd = #{item.dc_resn_cd}
                    </if>
                    WHERE hspt_cd = #{hspt_cd}
                      AND rcpn_sqno = #{rcpn_sqno}
                      AND prsc_sqno = #{item.prsc_sqno}
                </if>
                <!-- 약주사 처방 -->
                <if test='item.prsc_clsf_cd == "B1" or item.prsc_clsf_cd == "B2" or item.prsc_clsf_cd == "B3" or item.prsc_clsf_cd == "B4"'>
                    UPDATE crdrinprnt
                    SET last_updt_usid = #{last_updt_usid},
                        last_uddt = #{last_uddt},
                        prsc_nm = #{item.prsc_nm},
                        sort_sqno = #{item.row},
                        dosg_1 = #{item.dosg_1},
                        totl_vol = #{item.totl_vol},
                        notm = #{item.notm},
                        nody = #{item.nody},
                        iotm_cd = #{item.iotm_cd},
                        mix_yn = #{item.mix_yn},
                        mix_no = #{item.mix_no},
                    prsc_pay_dvcd = #{item.prsc_pay_dvcd},
                        hsin_hsot_dvcd = #{item.hsin_hsot_dvcd},
                        hsin_prsc_resn_cd = #{item.hsin_prsc_resn_cd},
                        cmpt_yn = #{item.cmpt_yn},
                        prsc_memo = #{item.prsc_memo},
                        jx999 = #{item.jx999},
                        dc_yn = #{item.dc_yn}
                    <if test='item.dc_yn == "Y"'>
                        , dc_drcn_dr_id = #{usid},
                        dc_drcn_dt = #{dateTime},
                        dc_resn = #{item.dc_resn},
                        dc_resn_cd =#{item.dc_resn_cd}
                    </if>
                    WHERE hspt_cd = #{hspt_cd}
                      AND rcpn_sqno = #{rcpn_sqno}
                      AND prsc_sqno = #{item.prsc_sqno}
                </if>
                <!-- 검사 처방 -->
                <if test='item.prsc_clsf_cd == "C1" or item.prsc_clsf_cd == "C2" or item.prsc_clsf_cd == "C3"'>
                    UPDATE crexmprsnt
                    SET last_updt_usid = #{last_updt_usid},
                        last_uddt = #{last_uddt},
                        prsc_nm = #{item.prsc_nm},
                        sort_sqno = #{item.row},
                        cmpt_yn = #{item.cmpt_yn},
                        prsc_memo = #{item.prsc_memo},
                        jx999 = #{item.jx999},
                    prsc_pay_dvcd = #{item.prsc_pay_dvcd},
                        dc_yn = #{item.dc_yn},
                    spcm_cd_1 = #{item.spcm_cd_1}
                    <if test='item.dc_yn == "Y"'>
                        , dc_drcn_dr_id = #{usid},
                        dc_drcn_dt = #{dateTime},
                        dc_resn = #{item.dc_resn},
                        dc_resn_cd =#{item.dc_resn_cd},
                    </if>
                    WHERE hspt_cd = #{hspt_cd}
                      AND rcpn_sqno = #{rcpn_sqno}
                      AND prsc_sqno = #{item.prsc_sqno}
                </if>
                <!-- 처치 처방 -->
                <if test='item.prsc_clsf_cd == "D" or item.prsc_clsf_cd == "D1" or item.prsc_clsf_cd == "D2" or item.prsc_clsf_cd == "D3" or item.prsc_clsf_cd == "D4" or item.prsc_clsf_cd == "D5"'>
                    UPDATE crtrtprsnt
                    SET last_updt_usid = #{last_updt_usid},
                        last_uddt = #{last_uddt},
                        prsc_nm = #{item.prsc_nm},
                        sort_sqno = #{item.row},
                        cmpt_yn = #{item.cmpt_yn},
                        prsc_memo = #{item.prsc_memo},
                        jx999 = #{item.jx999},
                    prsc_pay_dvcd = #{item.prsc_pay_dvcd},
                        dc_yn = #{item.dc_yn},
                        qty = #{item.dosg_1},
                        notm = #{item.notm}
                    <if test='item.dc_yn == "Y"'>
                        , dc_drcn_dr_id = #{usid},
                        dc_drcn_dt = #{dateTime},
                        dc_resn = #{item.dc_resn},
                        dc_resn_cd =#{item.dc_resn_cd}
                    </if>
                    WHERE hspt_cd = #{hspt_cd}
                      AND rcpn_sqno = #{rcpn_sqno}
                      AND prsc_sqno = #{item.prsc_sqno}
                </if>
            </foreach>
        </if>
    </update>

<!--    의약분업예외 목록 조회        -->
    <select id="excpList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CZ2001'
        ORDER BY cmcd_cd
    </select>

<!--    용법 목록 조회        -->
    <select id="iotmList" resultType="java.util.HashMap">
        SELECT iotm_cd As value,
               iotm_nm As text,
               prsc_clsf_cd,
               tkng_notm As notm
        FROM csiotinfmt
        WHERE hspt_cd = #{hspt_cd}
          AND use_yn = 'Y'
        ORDER BY iotm_cd
    </select>

<!--    처방 약속 분류 저장     -->
    <insert id="savePrscSet" parameterType="java.util.Objects">
        <!-- 처방 분류 직접 입력 시 -->
        <if test="set.set_prsc_uprn_sqno == -1">
            INSERT INTO crsetprsmt
                (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt, set_prsc_usid, set_prsc_uprn_sqno, set_prsc_nm)
            VALUES (
                #{hspt_cd},
                #{frst_rgst_usid},
                #{frst_rgdt},
                #{last_updt_usid},
                #{last_uddt},
                #{usid},
                1,
                #{uprnSetNm});
        </if>
        INSERT INTO crsetprsmt
            (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt, set_prsc_usid, set_prsc_uprn_sqno, set_prsc_nm)
        VALUES (
            #{hspt_cd},
            #{frst_rgst_usid},
            #{frst_rgdt},
            #{last_updt_usid},
            #{last_uddt},
            #{usid},
            <choose>
                <when test='set.set_prsc_uprn_sqno == -1'>
                    (SELECT AUTO_INCREMENT - 1
                    FROM information_schema.tables
                    WHERE table_name = 'crsetprsmt'
                    AND table_schema = DATABASE( )),
                </when>
                <otherwise>
                    #{set.set_prsc_uprn_sqno},
                </otherwise>
            </choose>
            #{set.set_prsc_nm});

        <!--  처방 저장   -->
        <foreach collection="setPrsc" item="item" separator=";">
            INSERT INTO crsetprsdt
                (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                set_prsc_sqno, prsc_sqno, prsc_cd, prsc_nm, prsc_clsf_cd, prsc_dosg1, prsc_notm, prsc_nody,
                iotm_cd, hsin_hsot_dvcd, spfm_excp_resn_cd,
                mix_yn, mix_no, prsc_qty, inpy_dvcd, sort_sqno)
            SELECT
                #{hspt_cd},
                #{frst_rgst_usid},
                #{frst_rgdt},
                #{last_updt_usid},
                #{last_uddt},
                        (SELECT AUTO_INCREMENT - 1
                        FROM information_schema.tables
                        WHERE table_name = 'crsetprsmt'
                        AND table_schema = DATABASE( )),
                IFNULL(MAX(crsetprsdt.prsc_sqno) + 1, 1),
                #{item.prsc_cd},
                #{item.prsc_nm},
                #{item.prsc_clsf_cd},
                #{item.dosg_1},
                #{item.notm},
                #{item.nody},
                #{item.iotm_cd},
                #{item.hsin_hsot_dvcd},
                #{item.hsin_prsc_resn_cd},
                #{item.mix_yn},
                #{item.mix_no},
                #{item.totl_vol},
                #{item.inpy_dvcd},
                #{item.row}
            FROM crsetprsdt
            WHERE set_prsc_sqno =
                    (SELECT AUTO_INCREMENT - 1
                    FROM information_schema.tables
                    WHERE table_name = 'crsetprsmt'
                    AND table_schema = DATABASE( ))
        </foreach>;

        <!--   진단 저장  -->
        <if test='setDgns != null and setDgns.size != 0'>
            <foreach collection="setDgns" item="item" separator=";">
                INSERT INTO crsetdigdt
                (hspt_cd, frst_rgst_usid, frst_rgdt, last_updt_usid, last_uddt,
                set_prsc_sqno, dgns_sqno, dgns_cd, dgns_nm, dgns_site_cd, sort_sqno)
                SELECT
                #{hspt_cd},
                #{frst_rgst_usid},
                #{frst_rgdt},
                #{last_updt_usid},
                #{last_uddt},
                        (SELECT AUTO_INCREMENT - 1
                        FROM information_schema.tables
                        WHERE table_name = 'crsetprsmt'
                        AND table_schema = DATABASE( )),
                IFNULL(MAX(crsetdigdt.dgns_sqno) + 1, 1),
                #{item.dgns_cd},
                #{item.dgns_nm},
                #{item.site_dvcd},
                #{item.row}
                FROM crsetdigdt
                WHERE set_prsc_sqno =
                        (SELECT AUTO_INCREMENT - 1
                        FROM information_schema.tables
                        WHERE table_name = 'crsetprsmt'
                        AND table_schema = DATABASE( ))
            </foreach>;
        </if>
    </insert>

<!--    DC 사유 목록        -->
    <select id="dcList" resultType="java.util.HashMap">
        SELECT cmcd_cd As value,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CR3002'
        ORDER BY cmcd_cd
    </select>

<!--    급여 목록       -->
    <select id="prscPayList" resultType="java.util.HashMap">
        SELECT cmcd_cd As code,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB3001'
        ORDER BY cmcd_cd
    </select>
    
<!--    원외 목록       -->
    <select id="hostList" resultType="java.util.HashMap">
        SELECT cmcd_cd As code,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CR3003'
        ORDER BY cmcd_cd
    </select>
    
<!--    산정 목록       -->
    <select id="cmptList" resultType="java.util.HashMap">
        SELECT cmcd_cd As code,
               cmcd_nm As text
        FROM czcomcodmt
        WHERE hspt_cd = #{hspt_cd}
          AND cmcd_clsf_cd = 'CB2010'
        ORDER BY cmcd_cd
    </select>
<!--    ==========================================================================================================================================================-->

</mapper>
